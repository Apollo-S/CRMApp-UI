<p *ngIf="docService.getFilterState()">
    <p-card>
        <div class="ui-grid">
            <div class="ui-grid-row">
                <div class="ui-grid-col-2">
                    <b>Клиент:</b>
                </div>
                <div class="ui-grid-col-9">
                    <p-multiSelect
                        id="float-dropdown-clients"
                        [options]="clients"
                        optionLabel="title"
                        selectedItemsLabel="{0} эл. выбрано"
                        maxSelectedLabels="1"
                        [resetFilterOnHide]="true"
                        [panelStyle]="{minWidth:'12em'}"
                        [style]="{width:'300px'}"
                        defaultLabel="Не выбрано"
                        [(ngModel)]="docService.docFilter.selectedClients"
                    ></p-multiSelect>
                </div>
                <div class="ui-grid-col-1">
                    <button
                        pButton type="button"
                        class="ui-button-info btn-block"
                        style="float:right"
                        icon="fa fa-filter"
                        label="Фильтровать"
                        (click)="useFilter('id', 'asc')"
                    ></button>
                </div>
            </div>    
            <div class="ui-grid-row">
                <div class="ui-grid-col-2">
                    <b>Тип документа:</b>
                </div>
                <div class="ui-grid-col-9">
                    <p-multiSelect
                        [options]="docTypes"
                        optionLabel="title"
                        selectedItemsLabel="{0} эл. выбрано"
                        maxSelectedLabels="1"
                        [resetFilterOnHide]="true"
                        [panelStyle]="{minWidth:'12em'}"
                        [style]="{width:'300px'}"
                        defaultLabel="Не выбрано"
                        [(ngModel)]="docService.docFilter.selectedDocTypes"
                    ></p-multiSelect>
                </div>
                <div class="ui-grid-col-1">
                    <button
                        pButton type="button"
                        class="ui-button-success btn-block"
                        style="float:right"
                        icon="fa fa-trash"
                        label="Очистить"
                        (click)="clearFilter()"
                    ></button>
                </div>
            </div>     
            <div class="ui-grid-row">
                <div class="ui-grid-col-2">
                    <b>Статус:</b>
                </div>
                <div class="ui-grid-col-9">
                    <p-multiSelect
                        [options]="docStatuses"
                        optionLabel="status"
                        selectedItemsLabel="{0} эл. выбрано"
                        maxSelectedLabels="1"
                        [resetFilterOnHide]="true"
                        [panelStyle]="{minWidth:'12em'}"
                        [style]="{width:'300px'}"
                        defaultLabel="Не выбрано"
                        [(ngModel)]="docService.docFilter.selectedDocStatuses"
                    ></p-multiSelect>
                </div>
                <div class="ui-grid-col-1">
                    <button
                        pButton type="button"
                        class="ui-button-danger btn-block"
                        style="float:right"
                        icon="fa fa-times"
                        label="Закрыть"
                        (click)="changeFilterState()"
                    ></button>
                </div>
            </div>
            <br>
            <div class="ui-grid-row">
                <div class="ui-grid-col-2">
                    <b>Сортировка:</b>
                </div>
                <div class="ui-grid-col-2">
                    <span class="ui-float-label">
                        <p-dropdown
                            id="float-dropdown-field"
                            [options]="columns"
                            [style]="{'width':'90%'}"
                            optionLabel="header"
                            [autoWidth]="false"
                            [showClear]="false"
                            [(ngModel)]="docService.docFilter.selectedSortField"
                        ></p-dropdown>
                        <label for="float-dropdown-field"><b>Столбец</b></label>
                    </span>
                </div>
                <div class="ui-grid-col-2">
                    <span class="ui-float-label">
                        <p-dropdown
                            id="float-dropdown-type"
                            [options]="sortTypes"
                            [style]="{'width':'90%'}"
                            [autoWidth]="false"
                            [showClear]="false"
                            [(ngModel)]="docService.docFilter.selectedSortType"
                        ></p-dropdown>
                        <label for="float-dropdown-type"><b>Тип сортировки</b></label>
                    </span>
                </div>
            </div>
        </div>
    </p-card>
</p>

<p></p>

<p-panel>
  <p-header>
      <div class="ui-helper-clearfix">
        <span class="ui-panel-title" style="display:inline-block;margin-top:6px">
            <h4><b>Документы</b></h4>
        </span>
            <button
                pButton type="button"
                icon="fa fa-filter"
                label="Фильтр"
                (click)="changeFilterState()"
                class="ui-button-info"
                style="margin-top:6px;margin-right:4px;float:right"
            ></button>
      </div>
  </p-header>

  <p-table #dt
     [columns]="columns"
     [responsive]="true"
     (sortFunction)="customSort($event)"
     [customSort]="false"
     [value]="documents"
     [reorderableColumns]="true"
     [columnResizeMode]="'expand'"
     [autoLayout]="true"
     [rows]="10"
     [rowHover]="true"
     [paginator]="true"
     [rowsPerPageOptions]="[10, 20, 30, 40]"
     [paginatorPosition]="'both'"
     [dataKey]="'id'"
     [sortField]="'id'"
     [loading]="loadingState"
    >
        <ng-template pTemplate="caption">
            <div>
                <button
                    pButton type="button"
                    label="Добавить"
                    style="margin-top:2px;float:left"
                    [routerLink]="['add']"
                    icon="fa fa-plus"
                    class="ui-button-rounded ui-button-primary"
                ></button>
                <button
                    pButton type="button"
                    [label]="'Обновить'"
                    style="margin-left:2px;margin-top:2px;float:left"
                    icon="fa fa-refresh"
                    class="ui-button-rounded ui-button-primary"
                    (click)="refresh()"
                ></button>
            </div>
            <div style="text-align: right">
                <i class="fa fa-search" style="margin:4px 4px 0 0"></i>
                <input
                    type="text" pInputText
                    size="50"
                    placeholder="Фильтр"
                    style="width:auto"
                    (input)="dt.filterGlobal($event.target.value, 'contains')"
                >
            </div>
        </ng-template>
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th style="width: 2.25em"></th>
                <th *ngFor="let column of columns" style="text-align:center"
                    [pSortableColumn]="column.field" pReorderableColumn>
                    {{column.header}}
                    <p-sortIcon [field]="column.field"></p-sortIcon>
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-document let-rowData let-expanded="expanded" let-columns="columns">
            <tr [ngStyle]="{'background-color': document.status.backgroundColor, 'color': document.status.color}">
                <td>
                    <a href="#" [pRowToggler]="rowData">
                        <i [ngClass]="expanded ? 'fa fa-toggle-down' : 'fa fa-toggle-right'"></i>
                    </a>
                </td>

                <td style="text-align:center" (click)="goToEntry(document?.url)">
                    {{document.id}}
                </td>
                <td style="text-align:left" (click)="goToEntry(document?.url)">
                    {{document.docType.shortTitle}}
                </td>
                <td style="text-align:center" (click)="goToEntry(document?.url)">
                    {{document.number}}
                </td>
                <td style="text-align:center" (click)="goToEntry(document?.url)">
                    {{document.amount | number: '3.2-2'}}
                </td>
                <td style="text-align:center" (click)="goToEntry(document?.url)">
                    {{document.dated === null ? '-' : document.dated | date: 'dd.MM.y'}}
                </td>
                <td style="text-align:center" (click)="goToEntry(document?.url)">
                    {{document.paymentDate === null ? '-' : document.paymentDate | date: 'dd.MM.y'}}
                </td>
                <td style="text-align:center" (click)="goToEntry(document?.url)">
                    {{document.status.status}}
                </td>
                <td style="text-align:center" (click)="goToEntry(document?.url)">
                    {{document.passingDate === null ? '-' : document.passingDate | date: 'dd.MM.y'}}
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="rowexpansion" let-rowData let-columns="columns">
            <tr>
                <td [attr.colspan]="columns.length + 2">
                    <div class="ui-g-12 ui-md-12">
                        <p-card>
                            <div class="ui-helper-clearfix">
                                <span class="ui-panel-title" style="display:inline-block;margin-top:4px">
                                    <h5><b>Контрагент: </b> <a [routerLink]="['/clients', rowData.clientId]">
                                        {{rowData.clientTitle}}
                                    </a></h5>
                                    <h5><b>Договор: </b> <a [routerLink]="['/agreements', rowData.agreementId]">
                                        {{rowData.agreementNumber + ' от '}} {{rowData.agreementDateStart | date: 'dd.MM.y'}}
                                    </a></h5>
                                    <h5><b>Примечание: </b> <i>
                                        {{rowData.comment === '' ? '-' : rowData.comment}}
                                    </i></h5>
                                </span>
                            </div>
                        </p-card>
                    </div>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage" let-columns *ngIf="loadingState">
            <tr>
                <td [attr.colspan]="columns.length + 1" style="text-align:center">
                    <img
                            src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="
                    />
                </td>
            </tr>
        </ng-template>
      <ng-template pTemplate="emptymessage" let-columns *ngIf="!loadingState">
          <tr>
              <td [attr.colspan]="columns.length + 1" style="text-align:center">
                  No records found
              </td>
          </tr>
      </ng-template>
        <ng-template pTemplate="summary">
            Кол-во записей: {{documents?.length}}
        </ng-template>
    </p-table>
</p-panel>
